/*! For license information please see index.js.LICENSE.txt */
var Skill=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),n=function(){function e(e,t,r,n){this.requestId=o.v4(),this.requestMessage=e,this.transportProtocol=t,this.onSuccess=r,this.onFailure=n}return e.prototype.getRequestId=function(){return this.requestId},e.prototype.getTransportProtocol=function(){return this.transportProtocol},e.prototype.getRequestMessage=function(){return this.requestMessage},e.prototype.onSuccess=function(e){return this.onSuccessCallback(e)},e.prototype.onFailure=function(e){return this.onFailureCallback(e)},e}();t.RequestContext=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.RAW_TCP=0]="RAW_TCP",e[e.RAW_UDP=1]="RAW_UDP",e[e.HTTP=2]="HTTP"}(t.TransportProtocol||(t.TransportProtocol={}))},function(e,t,r){var o=r(14),n=r(15),s=n;s.v1=o,s.v4=n,e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(19),n=r(2),s=r(8),i=r(9),a=function(){function e(){}return e.createResponse=function(e,t){return{context:t,event:{endpoint:{endpointId:e},header:{messageId:n.v4(),name:"Response",namespace:"Alexa",payloadVersion:"3"},payload:{}}}},e.createErrorResponse=function(e,t,r,o){void 0===r&&(r="");var s={message:t,type:e};void 0!==o&&(s.currentDeviceMode=o);return console.log("ERROR response: "+JSON.stringify(s)),{event:{endpoint:{endpointId:r},header:{messageId:n.v4(),name:"ErrorResponse",namespace:"Alexa",payloadVersion:"3"},payload:s}}},e.createIdentifyEndpointsResponse=function(t){var r=t.payload.response.message.system.get_sysinfo,o=s.ProductInfoHelper.getProductType(r);if(null===o){var i=e.className+":: Product type not received";return console.debug(i),e.createErrorResponse("INTERNAL_ERROR",i)}var a=[];if(s.ProductInfoHelper.isDeviceSupportedForLocalSkill(r))a=s.ProductInfoHelper.isBulb(o)?e.createBulbEndpoints(r):e.createSwitchOrPlugEndpoints(r);else{i=e.className+":: "+r.model+" is not supported via LAP";console.debug(i)}return{event:{header:{messageId:n.v4(),name:"Discover.Response",namespace:"Alexa.Discovery",payloadVersion:"3"},payload:{endpoints:a}}}},e.createDeviceStateResponse=function(t,r,o){var n=[];return e.pushLightStateProperties(n,r,o),e.createResponse(t,{properties:n})},e.formatMacString=function(e){return e[0]+e[1]+":"+e[2]+e[3]+":"+e[4]+e[5]+":"+e[6]+e[7]+":"+e[8]+e[9]+":"+e[10]+e[11]},e.createBulbEndpoints=function(t){s.ProductInfoHelper.getProductType(t);var r=e.getFormattedMacAddress(t.mic_mac);return[e.createEndpoint(t,{description:t.description,mac:r,serviceUsed:t.hasOwnProperty("length")?"smartlife.iot.lightStrip":"smartlife.iot.smartbulb.lightingservice"})]},e.createSwitchOrPlugEndpoints=function(t){return[e.createEndpoint(t,{description:t.dev_name,mac:t.mac,serviceUsed:"system"})]},e.createEndpoint=function(t,r){var n=s.ProductInfoHelper.getCapabilityFlags(t);return{additionalAttributes:{customIdentifier:t.deviceId,firmwareVersion:t.fwId,model:t.model},capabilities:s.ProductInfoHelper.getCapabilities(n),connections:[{macAddress:r.mac,type:"UDP_IP"},{macAddress:r.mac,type:"TCP_IP"}],cookie:{model:t.model,productCapabilityFlags:JSON.stringify(n),serviceUsed:r.serviceUsed},description:r.description,displayCategories:s.ProductInfoHelper.getDisplayCategories(t),endpointId:o(e.SKILL_NAME+t.deviceId),friendlyName:t.alias,manufacturerName:"TP-LINK"}},e.getFormattedMacAddress=function(t){return/^([0-9A-Fa-f]{2}[:]){5}([0-9A-Fa-f]{2})$/.test(t)?t:e.formatMacString(t)},e.pushLightStateProperties=function(e,t,r){var o={brightness:!0,color:!0,colorTemperature:!0};if(void 0!==r&&(o=r),void 0!==t.on_off&&e.push({name:"powerState",namespace:"Alexa.PowerController",timeOfSample:(new Date).toUTCString(),uncertaintyInMilliseconds:0,value:i.UnitConverter.powerFromTPLink(t.on_off)}),o.brightness&&void 0!==t.brightness&&e.push({name:"brightness",namespace:"Alexa.BrightnessController",timeOfSample:(new Date).toUTCString(),uncertaintyInMilliseconds:0,value:i.UnitConverter.brightnessFromTPLink(t.brightness)}),o.color&&0===t.color_temp&&void 0!==t.brightness&&void 0!==t.hue&&void 0!==t.saturation){var n=i.UnitConverter.colorBrightnessFromTPLink(t.brightness),s=i.UnitConverter.hueFromTPLink(t.hue),a=i.UnitConverter.saturationFromTPLink(t.saturation);e.push({name:"color",namespace:"Alexa.ColorController",timeOfSample:(new Date).toUTCString(),uncertaintyInMilliseconds:0,value:{brightness:n,hue:s,saturation:a}})}if(o.colorTemperature&&void 0!==t.color_temp&&0!==t.color_temp){var c=i.UnitConverter.colorTemperatureFromTPLink(t.color_temp);e.push({name:"colorTemperatureInKelvin",namespace:"Alexa.ColorTemperatureController",timeOfSample:(new Date).toUTCString(),uncertaintyInMilliseconds:0,value:c})}},e.className="DirectiveResponseCreator",e.SKILL_NAME="TP-LINK",e}();t.DirectiveResponseCreator=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(13);t.HttpRequestContext=o.HttpRequestContext;var n=r(0);t.RequestContext=n.RequestContext;var s=r(16);t.TCPRequestContext=s.TCPRequestContext;var i=r(1);t.TransportProtocol=i.TransportProtocol;var a=r(17);t.UDPRequestContext=a.UDPRequestContext},function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var o=new Uint8Array(16);e.exports=function(){return r(o),o}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},function(e,t){for(var r=[],o=0;o<256;++o)r[o]=(o+256).toString(16).substr(1);e.exports=function(e,t){var o=t||0,n=r;return[n[e[o++]],n[e[o++]],n[e[o++]],n[e[o++]],"-",n[e[o++]],n[e[o++]],"-",n[e[o++]],n[e[o++]],"-",n[e[o++]],n[e[o++]],"-",n[e[o++]],n[e[o++]],n[e[o++]],n[e[o++]],n[e[o++]],n[e[o++]]].join("")}},function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.isDeviceSupportedForLocalSkill=function(e){return this.isProductTypeSupported(this.getProductType(e))&&!("children"in e)?(console.debug("returning true "+JSON.stringify(e)),!0):(console.debug("returning false "+JSON.stringify(e)),!1)},e.getCapabilityFlags=function(e){var t={brightness:!1,color:!1,colorTemperature:!1};return 1!==e.is_dimmable&&"number"!=typeof e.brightness||(t.brightness=!0),1===e.is_color&&(t.color=!0),1===e.is_variable_color_temp&&(t.colorTemperature=!0),t},e.getCapabilities=function(t){var r=[e.powerControllerCapability];return t.brightness&&r.push(e.brightnessCapability),t.color&&r.push(e.colorCapability),t.colorTemperature&&r.push(e.colorTemperatureCapability),r},e.getDisplayCategories=function(t){var r=[];if(!e.isDeviceSupportedForLocalSkill(t))return r;var o=this.getProductType(t);return"IOT.SMARTPLUGSWITCH"===o?t.dev_name.includes("Plug")?r.push("SMARTPLUG"):r.push("SWITCH"):"IOT.SMARTBULB"===o&&r.push("LIGHT"),r},e.isBulb=function(e){return"IOT.SMARTBULB"===e},e.getProductType=function(e){var t=null;return void 0!==e.mic_type?t=e.mic_type:void 0!==e.type&&(t=e.type),t},e.getMinimumColorTemperature=function(e){return 2500},e.getMaximumColorTemperature=function(t){switch(e.getBaseModel(t)){case"KL130":return 9e3;default:return 6500}},e.isProductTypeSupported=function(e){return"IOT.SMARTPLUGSWITCH"===e||"IOT.SMARTBULB"===e},e.getBaseModel=function(e){var t=e.toUpperCase().match(/^[a-z0-9]+/i);return t&&"string"==typeof t[0]?t[0]:""},e.powerControllerCapability={interface:"Alexa.PowerController",properties:{proactivelyReported:!1,retrievable:!0,supported:[{name:"powerState"}]},type:"AlexaInterface",version:"3"},e.colorCapability={interface:"Alexa.ColorController",properties:{proactivelyReported:!1,retrievable:!0,supported:[{name:"color"}]},type:"AlexaInterface",version:"3"},e.colorTemperatureCapability={interface:"Alexa.ColorTemperatureController",properties:{proactivelyReported:!1,retrievable:!0,supported:[{name:"colorTemperatureInKelvin"}]},type:"AlexaInterface",version:"3"},e.brightnessCapability={interface:"Alexa.BrightnessController",properties:{proactivelyReported:!1,retrievable:!0,supported:[{name:"brightness"}]},type:"AlexaInterface",version:"3"},e}();t.ProductInfoHelper=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.brightnessFromTPLink=function(e){return e},e.brightnessFromAlexa=function(e){return Math.round(e)},e.colorBrightnessFromTPLink=function(e){return e/100},e.colorBrightnessFromAlexa=function(e){return Math.round(100*e)},e.hueFromTPLink=function(e){return e},e.hueFromAlexa=function(e){return Math.round(e)},e.saturationFromTPLink=function(e){return e/100},e.saturationFromAlexa=function(e){return Math.round(100*e)},e.colorTemperatureFromTPLink=function(e){return e},e.colorTemperatureFromAlexa=function(e){return e},e.increaseColorTemperature=function(e,t){var r=e+t;return r<=1e4?r:1e4},e.decreaseColorTemperature=function(e,t){var r=e-t;return r>=1e3?r:1e3},e.powerFromTPLink=function(e){return 0===e?"OFF":"ON"},e.powerFromAlexa=function(e){return"ON"===e.toUpperCase()?1:0},e.adjustAlexaBrightness=function(e,t){var r=e+t;return r<0&&(r=0),r>100&&(r=100),r},e}();t.UnitConverter=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.encrypt=function(t){for(var r=(new e.TEXT_ENCODER_TYPE).encode(t),o=e.INITIAL_XOR_KEY,n=0;n<r.byteLength;n++)r[n]=r[n]^o,o=r[n];return r},e.decrypt=function(t){for(var r,o=e.INITIAL_XOR_KEY,n=0;n<t.byteLength;n++)r=t[n],t[n]=t[n]^o,o=r;return(new e.TEXT_DECODER_TYPE).decode(t)},e.prependHeader=function(t){var r=t.byteLength,o=new Uint8Array(e.SIZE_OF_NEXT_DATA+r);return new DataView(o.buffer).setUint32(0,r,!1),o.set(t,e.SIZE_OF_NEXT_DATA),o},e.stripHeader=function(t){return t.subarray(e.SIZE_OF_NEXT_DATA)},e.TEXT_ENCODER_TYPE=TextEncoder,e.TEXT_DECODER_TYPE=TextDecoder,e.INITIAL_XOR_KEY=171,e.SIZE_OF_NEXT_DATA=4,e}();t.TPLinkCrypto=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.enc=function(e){return"undefined"!=typeof Base64?Base64.encode(e):new Buffer(e).toString("base64")},e.dec=function(e){return"undefined"!=typeof Base64?Base64.decode(e):new Uint8Array(new Buffer(e,"base64"))},e}();t.Base64Util=o},function(e,t,r){"use strict";var o=r(4),n=r(18),s=r(3),i=r(22),a=function(){function e(e,t){this.blueprintStore=e,this.actionOrchestrator=t,null==e&&(this.blueprintStore=new i.OrchestrationBlueprintStore),null==t&&(this.actionOrchestrator=new n.ActionOrchestrator)}return e.prototype.executeDirective=function(t,r,n,i){console.debug(e.className+":: Executing directive: "+JSON.stringify(t));var a=t.directive,c="",u={};if(void 0!==a.endpoint&&(c=a.endpoint.endpointId,u=a.endpoint.cookie),!r.isSupportedTransportProtocol(o.TransportProtocol.RAW_TCP)){var l=e.className+" requires TCP relay support to work!";return console.error(l),i(s.DirectiveResponseCreator.createErrorResponse("INTERNAL_ERROR",l,c))}var p=a.header.namespace,d=a.header.name,f=this.blueprintStore.getBlueprint(a.header);if(null===f){l=e.className+":: Directive with namespace: "+p+" and name: "+d+" not supported!";return console.error(l),i(s.DirectiveResponseCreator.createErrorResponse("INVALID_DIRECTIVE",l,c))}return this.actionOrchestrator.orchestrateAction(f,{cookie:u,endpointId:c,executionInfo:{},payload:{initialDirectivePayload:a.payload},requestRelay:r},n,i)},e.className="TPLinkSkill",e}();e.exports=a},function(e,t,r){"use strict";var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(0),i=r(1),a=function(e){function t(t,r,o){return e.call(this,t,i.TransportProtocol.HTTP,r,o)||this}return n(t,e),t}(s.RequestContext);t.HttpRequestContext=a},function(e,t,r){var o,n,s=r(5),i=r(6),a=0,c=0;e.exports=function(e,t,r){var u=t&&r||0,l=t||[],p=(e=e||{}).node||o,d=void 0!==e.clockseq?e.clockseq:n;if(null==p||null==d){var f=s();null==p&&(p=o=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=n=16383&(f[6]<<8|f[7]))}var m=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:c+1,g=m-a+(v-c)/1e4;if(g<0&&void 0===e.clockseq&&(d=d+1&16383),(g<0||m>a)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=m,c=v,n=d;var y=(1e4*(268435455&(m+=122192928e5))+v)%4294967296;l[u++]=y>>>24&255,l[u++]=y>>>16&255,l[u++]=y>>>8&255,l[u++]=255&y;var _=m/4294967296*1e4&268435455;l[u++]=_>>>8&255,l[u++]=255&_,l[u++]=_>>>24&15|16,l[u++]=_>>>16&255,l[u++]=d>>>8|128,l[u++]=255&d;for(var R=0;R<6;++R)l[u+R]=p[R];return t||i(l)}},function(e,t,r){var o=r(5),n=r(6);e.exports=function(e,t,r){var s=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[s+a]=i[a];return t||n(i)}},function(e,t,r){"use strict";var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(0),i=r(1),a=function(e){function t(t,r,o){return e.call(this,t,i.TransportProtocol.RAW_TCP,r,o)||this}return n(t,e),t}(s.RequestContext);t.TCPRequestContext=a},function(e,t,r){"use strict";var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(0),i=r(1),a=function(e){function t(t,r,o){return e.call(this,t,i.TransportProtocol.RAW_UDP,r,o)||this}return n(t,e),t}(s.RequestContext);t.UDPRequestContext=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),n=function(){function e(){}return e.prototype.orchestrateAction=function(e,t,r,n){var s=this;if(e.actions.length<1)return e.finalResponseCreator.createResponse(t,r,n);e.actions.shift().perform(t,(function(){return s.orchestrateAction(e,t,r,n)}),(function(e){return n(o.DirectiveResponseCreator.createErrorResponse(e.type,e.message,t.endpointId,e.currentDeviceMode))}))},e}();t.ActionOrchestrator=n},function(e,t,r){var o,n,s,i,a;o=r(20),n=r(7).utf8,s=r(21),i=r(7).bin,(a=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?i.stringToBytes(e):n.stringToBytes(e):s(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var r=o.bytesToWords(e),c=8*e.length,u=1732584193,l=-271733879,p=-1732584194,d=271733878,f=0;f<r.length;f++)r[f]=16711935&(r[f]<<8|r[f]>>>24)|4278255360&(r[f]<<24|r[f]>>>8);r[c>>>5]|=128<<c%32,r[14+(c+64>>>9<<4)]=c;var m=a._ff,v=a._gg,g=a._hh,y=a._ii;for(f=0;f<r.length;f+=16){var _=u,R=l,h=p,C=d;u=m(u,l,p,d,r[f+0],7,-680876936),d=m(d,u,l,p,r[f+1],12,-389564586),p=m(p,d,u,l,r[f+2],17,606105819),l=m(l,p,d,u,r[f+3],22,-1044525330),u=m(u,l,p,d,r[f+4],7,-176418897),d=m(d,u,l,p,r[f+5],12,1200080426),p=m(p,d,u,l,r[f+6],17,-1473231341),l=m(l,p,d,u,r[f+7],22,-45705983),u=m(u,l,p,d,r[f+8],7,1770035416),d=m(d,u,l,p,r[f+9],12,-1958414417),p=m(p,d,u,l,r[f+10],17,-42063),l=m(l,p,d,u,r[f+11],22,-1990404162),u=m(u,l,p,d,r[f+12],7,1804603682),d=m(d,u,l,p,r[f+13],12,-40341101),p=m(p,d,u,l,r[f+14],17,-1502002290),u=v(u,l=m(l,p,d,u,r[f+15],22,1236535329),p,d,r[f+1],5,-165796510),d=v(d,u,l,p,r[f+6],9,-1069501632),p=v(p,d,u,l,r[f+11],14,643717713),l=v(l,p,d,u,r[f+0],20,-373897302),u=v(u,l,p,d,r[f+5],5,-701558691),d=v(d,u,l,p,r[f+10],9,38016083),p=v(p,d,u,l,r[f+15],14,-660478335),l=v(l,p,d,u,r[f+4],20,-405537848),u=v(u,l,p,d,r[f+9],5,568446438),d=v(d,u,l,p,r[f+14],9,-1019803690),p=v(p,d,u,l,r[f+3],14,-187363961),l=v(l,p,d,u,r[f+8],20,1163531501),u=v(u,l,p,d,r[f+13],5,-1444681467),d=v(d,u,l,p,r[f+2],9,-51403784),p=v(p,d,u,l,r[f+7],14,1735328473),u=g(u,l=v(l,p,d,u,r[f+12],20,-1926607734),p,d,r[f+5],4,-378558),d=g(d,u,l,p,r[f+8],11,-2022574463),p=g(p,d,u,l,r[f+11],16,1839030562),l=g(l,p,d,u,r[f+14],23,-35309556),u=g(u,l,p,d,r[f+1],4,-1530992060),d=g(d,u,l,p,r[f+4],11,1272893353),p=g(p,d,u,l,r[f+7],16,-155497632),l=g(l,p,d,u,r[f+10],23,-1094730640),u=g(u,l,p,d,r[f+13],4,681279174),d=g(d,u,l,p,r[f+0],11,-358537222),p=g(p,d,u,l,r[f+3],16,-722521979),l=g(l,p,d,u,r[f+6],23,76029189),u=g(u,l,p,d,r[f+9],4,-640364487),d=g(d,u,l,p,r[f+12],11,-421815835),p=g(p,d,u,l,r[f+15],16,530742520),u=y(u,l=g(l,p,d,u,r[f+2],23,-995338651),p,d,r[f+0],6,-198630844),d=y(d,u,l,p,r[f+7],10,1126891415),p=y(p,d,u,l,r[f+14],15,-1416354905),l=y(l,p,d,u,r[f+5],21,-57434055),u=y(u,l,p,d,r[f+12],6,1700485571),d=y(d,u,l,p,r[f+3],10,-1894986606),p=y(p,d,u,l,r[f+10],15,-1051523),l=y(l,p,d,u,r[f+1],21,-2054922799),u=y(u,l,p,d,r[f+8],6,1873313359),d=y(d,u,l,p,r[f+15],10,-30611744),p=y(p,d,u,l,r[f+6],15,-1560198380),l=y(l,p,d,u,r[f+13],21,1309151649),u=y(u,l,p,d,r[f+4],6,-145523070),d=y(d,u,l,p,r[f+11],10,-1120210379),p=y(p,d,u,l,r[f+2],15,718787259),l=y(l,p,d,u,r[f+9],21,-343485551),u=u+_>>>0,l=l+R>>>0,p=p+h>>>0,d=d+C>>>0}return o.endian([u,l,p,d])})._ff=function(e,t,r,o,n,s,i){var a=e+(t&r|~t&o)+(n>>>0)+i;return(a<<s|a>>>32-s)+t},a._gg=function(e,t,r,o,n,s,i){var a=e+(t&o|r&~o)+(n>>>0)+i;return(a<<s|a>>>32-s)+t},a._hh=function(e,t,r,o,n,s,i){var a=e+(t^r^o)+(n>>>0)+i;return(a<<s|a>>>32-s)+t},a._ii=function(e,t,r,o,n,s,i){var a=e+(r^(t|~o))+(n>>>0)+i;return(a<<s|a>>>32-s)+t},a._blocksize=16,a._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=o.wordsToBytes(a(e,t));return t&&t.asBytes?r:t&&t.asString?i.bytesToString(r):o.bytesToHex(r)}},function(e,t){var r,o;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&o.rotl(e,8)|4278255360&o.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=o.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,o=0;r<e.length;r++,o+=8)t[o>>>5]|=e[r]<<24-o%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],o=0;o<e.length;o+=3)for(var n=e[o]<<16|e[o+1]<<8|e[o+2],s=0;s<4;s++)8*o+6*s<=8*e.length?t.push(r.charAt(n>>>6*(3-s)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],o=0,n=0;o<e.length;n=++o%4)0!=n&&t.push((r.indexOf(e.charAt(o-1))&Math.pow(2,-2*n+8)-1)<<2*n|r.indexOf(e.charAt(o))>>>6-2*n);return t}},e.exports=o},function(e,t){e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(23),n=r(24),s=r(25),i=r(26),a=r(28),c=r(3),u=r(8),l=r(9),p=function(){function e(){}return e.createPowerControlCommand=function(t,r){var o={system:{set_relay_state:{state:r}}};return t.executionInfo.validateResponseModuleName="system",t.executionInfo.validateResponseMethodName="set_relay_state",void 0!==t.cookie&&null!==t.cookie&&("child_id"in t.cookie&&(o.context={child_ids:[t.cookie.child_id],source:"alexa"}),"serviceUsed"in t.cookie&&"smartlife.iot.smartbulb.lightingservice"===t.cookie.serviceUsed?(o={context:{source:e.localApiMessageSource},"smartlife.iot.smartbulb.lightingservice":{transition_light_state:{on_off:r}}},t.executionInfo.validateResponseModuleName="smartlife.iot.smartbulb.lightingservice",t.executionInfo.validateResponseMethodName="transition_light_state"):"serviceUsed"in t.cookie&&"smartlife.iot.lightStrip"===t.cookie.serviceUsed&&(o={context:{source:"alexa"},"smartlife.iot.lightStrip":{set_light_state:{on_off:r}}},t.executionInfo.validateResponseModuleName="smartlife.iot.lightStrip",t.executionInfo.validateResponseMethodName="set_light_state")),console.debug("PowerControlCommand: "+JSON.stringify(o)),JSON.stringify(o)},e.createColorControlCommand=function(t){var r=t.payload.initialDirectivePayload.color,o={context:{source:e.localApiMessageSource},"smartlife.iot.smartbulb.lightingservice":{transition_light_state:{color_temp:0,hue:l.UnitConverter.hueFromAlexa(r.hue),ignore_default:1,on_off:l.UnitConverter.powerFromAlexa("ON"),saturation:l.UnitConverter.saturationFromAlexa(r.saturation)}}};return t.executionInfo.validateResponseModuleName="smartlife.iot.smartbulb.lightingservice",t.executionInfo.validateResponseMethodName="transition_light_state",console.debug("ColorControlCommand: "+JSON.stringify(o)),JSON.stringify(o)},e.increaseColorTemperature=function(t,r){e.adjustColorTemperature(t,r,"INCREASE")},e.decreaseColorTemperature=function(t,r){e.adjustColorTemperature(t,r,"DECREASE")},e.adjustColorTemperature=function(t,r,o){var n=e.getAdjustedColorTemperature(t,o);if(0===n)return r(e.errorColorTemperatureAdjustmentNotSupportedInColorMode);t.executionInfo.adjustedColorTemperature=n},e.createAdjustedColorTemperatureControlCommand=function(t){return e.createColorTemperatureControlCommand(t,t.executionInfo.adjustedColorTemperature)},e.createColorTemperatureControlCommand=function(t,r){var o=void 0!==r?r:t.payload.initialDirectivePayload.colorTemperatureInKelvin,n={context:{source:e.localApiMessageSource},"smartlife.iot.smartbulb.lightingservice":{transition_light_state:{color_temp:l.UnitConverter.colorTemperatureFromAlexa(o),ignore_default:1,on_off:l.UnitConverter.powerFromAlexa("ON")}}};return t.executionInfo.validateResponseModuleName="smartlife.iot.smartbulb.lightingservice",t.executionInfo.validateResponseMethodName="transition_light_state",console.debug("ColorControlCommand: "+JSON.stringify(n)),JSON.stringify(n)},e.getAdjustedColorTemperature=function(t,r){var o=e.getCurrentColorTemperature(t);if(0===o)return 0;var n=300;switch(o>=3e3&&(n=600),o>=5e3&&(n=1500),r){case"DECREASE":return e.getDecreasedColorTemperature(t,o,n);case"INCREASE":return e.getIncreasedColorTemperature(t,o,n)}},e.getDecreasedColorTemperature=function(t,r,o){var n=u.ProductInfoHelper.getMaximumColorTemperature(e.getModelFromCookie(t));return r>n&&(r=n),l.UnitConverter.decreaseColorTemperature(r,o)},e.getIncreasedColorTemperature=function(t,r,o){var n=u.ProductInfoHelper.getMinimumColorTemperature(e.getModelFromCookie(t));return r<n&&(r=n),l.UnitConverter.increaseColorTemperature(r,o)},e.getCurrentColorTemperature=function(t){var r=t.payload.response.message.system.get_sysinfo;if("light_state"in r){var o=e.normalizeLightState(r.light_state);if("number"==typeof o.color_temp)return l.UnitConverter.colorTemperatureFromTPLink(o.color_temp)}return 0},e.createStateQuery=function(e){return e.executionInfo.validateResponseModuleName="system",e.executionInfo.validateResponseMethodName="get_sysinfo",JSON.stringify({system:{get_sysinfo:{}}})},e.createBrightnessControlCommand=function(t,r){var o=e.isDeviceSmartBulb(t)?e.createBrightnessControlForSmartBulb(t,r):e.createBrightnessControlForDimmer(t,r);return console.debug("BrightnessControlCommand: "+JSON.stringify(o)),JSON.stringify(o)},e.createBrightnessControlForSmartBulb=function(t,r){var o,n,s="smartlife.iot.smartbulb.lightingservice",i="transition_light_state",a=((o={context:{source:e.localApiMessageSource}})[s]=((n={})[i]={},n),o),c=a[s][i];return 0===r?c.on_off=l.UnitConverter.powerFromAlexa("OFF"):(c.on_off=l.UnitConverter.powerFromAlexa("ON"),c.brightness=l.UnitConverter.brightnessFromAlexa(r),c.ignore_default=1),t.executionInfo.validateResponseModuleName=s,t.executionInfo.validateResponseMethodName=i,a},e.createBrightnessControlForDimmer=function(t,r){var o,n="smartlife.iot.dimmer",s="set_switch_state",i="set_brightness",a=((o={context:{source:e.localApiMessageSource}})[n]={},o.system={get_sysinfo:{}},o),c=a[n];return 0===r?(c.set_switch_state={state:0},t.executionInfo.validateResponseMethodName=s):(c.set_switch_state={state:1},c.set_brightness={brightness:l.UnitConverter.brightnessFromAlexa(r)},t.executionInfo.validateResponseMethodName=i),t.executionInfo.validateResponseModuleName=n,a},e.getAdjustedBrightness=function(t){var r=e.getCurrentBrightness(t),o=Number(t.payload.initialDirectivePayload.brightnessDelta);return l.UnitConverter.adjustAlexaBrightness(r,o)},e.getCurrentBrightness=function(e){var t=e.payload.response.message.system.get_sysinfo;if("light_state"in t){var r=t.light_state;return void 0!==r.brightness?l.UnitConverter.brightnessFromTPLink(r.brightness):0}return"number"==typeof t.brightness&&0!==t.relay_state?l.UnitConverter.brightnessFromTPLink(t.brightness):0},e.getStateQueryResponse=function(t){var r=t.payload.response.message.system.get_sysinfo;return"light_state"in r&&"number"==typeof r.light_state.on_off?e.normalizeLightState(r.light_state):e.getDimmerOrSwitchState(r)},e.getDeviceState=function(t){var r=t.payload.response.message;if("smartlife.iot.smartbulb.lightingservice"in r)return e.normalizeLightState(r["smartlife.iot.smartbulb.lightingservice"].transition_light_state);if("system"in r&&"get_sysinfo"in r.system){var o=r.system.get_sysinfo;if(0===o.err_code)return e.getDimmerOrSwitchState(o)}return{}},e.getDimmerOrSwitchState=function(e){var t={};return"number"==typeof e.brightness&&(t.brightness=e.brightness),"number"==typeof e.relay_state&&(t.on_off=e.relay_state),t},e.normalizeLightState=function(e){return 0===e.on_off&&(e.hue=e.dft_on_state.hue,e.mode=e.dft_on_state.mode,e.saturation=e.dft_on_state.saturation,e.color_temp=e.dft_on_state.color_temp,e.brightness=e.dft_on_state.brightness),e},e.getCapabilityFlags=function(e){var t={brightness:!1,color:!1,colorTemperature:!1};return void 0!==e.cookie&&void 0!==e.cookie.productCapabilityFlags&&(t=JSON.parse(e.cookie.productCapabilityFlags)),t},e.isDeviceSmartBulb=function(e){return void 0!==e.cookie&&null!==e.cookie&&"serviceUsed"in e.cookie&&"smartlife.iot.smartbulb.lightingservice"===e.cookie.serviceUsed},e.getModelFromCookie=function(e){return void 0!==e.cookie&&null!==e.cookie&&"string"==typeof e.cookie.model?e.cookie.model:""},e.prototype.getBlueprint=function(t){var r=t.namespace,o=t.name;if(!(r in e.DIRECTIVE_TO_BLUEPRINT_MAPPING)||!(o in e.DIRECTIVE_TO_BLUEPRINT_MAPPING[r]))return null;var n=e.DIRECTIVE_TO_BLUEPRINT_MAPPING[r][o];return{actions:n.actions.slice(),finalResponseCreator:n.finalResponseCreator}},e.className="OrchestrationBlueprintStore",e.localApiMessageSource="alexa",e.errorColorTemperatureAdjustmentNotSupportedInColorMode={currentDeviceMode:"COLOR",message:"That only works when your light is set to a shade of white",type:"NOT_SUPPORTED_IN_CURRENT_MODE"},e.deviceStateFinalResponseCreator=new o.FinalResponseCreator((function(t){return c.DirectiveResponseCreator.createDeviceStateResponse(t.endpointId,e.getDeviceState(t),e.getCapabilityFlags(t))})),e.sendStateQuery=new a.SendRelayRequestAction(e.createStateQuery),e.parseResponse=new i.ParseRelayResponseAction,e.checkResponse=new s.ModuleErrorAction,e.REPORT_STATE_BLUEPRINT={actions:[e.sendStateQuery,e.parseResponse,e.checkResponse],finalResponseCreator:new o.FinalResponseCreator((function(t){return c.DirectiveResponseCreator.createDeviceStateResponse(t.endpointId,e.getStateQueryResponse(t),e.getCapabilityFlags(t))}))},e.TURN_OFF_BLUEPRINT={actions:[new a.SendRelayRequestAction((function(t){return e.createPowerControlCommand(t,0)})),e.parseResponse,e.checkResponse],finalResponseCreator:new o.FinalResponseCreator((function(e){return c.DirectiveResponseCreator.createDeviceStateResponse(e.endpointId,{on_off:0})}))},e.TURN_ON_BLUEPRINT={actions:[new a.SendRelayRequestAction((function(t){return e.createPowerControlCommand(t,1)})),e.parseResponse,e.checkResponse],finalResponseCreator:new o.FinalResponseCreator((function(e){return c.DirectiveResponseCreator.createDeviceStateResponse(e.endpointId,{on_off:1})}))},e.IDENTIFY_ENDPOINTS_BLUEPRINT={actions:[new i.ParseRelayResponseAction(!1)],finalResponseCreator:new o.FinalResponseCreator(c.DirectiveResponseCreator.createIdentifyEndpointsResponse)},e.SET_BRIGHTNESS_BLUEPRINT={actions:[new a.SendRelayRequestAction((function(t){return e.createBrightnessControlCommand(t,t.payload.initialDirectivePayload.brightness)})),e.parseResponse,e.checkResponse],finalResponseCreator:e.deviceStateFinalResponseCreator},e.ADJUST_BRIGHTNESS_BLUEPRINT={actions:[e.sendStateQuery,e.parseResponse,e.checkResponse,new a.SendRelayRequestAction((function(t){return e.createBrightnessControlCommand(t,e.getAdjustedBrightness(t))})),e.parseResponse,e.checkResponse],finalResponseCreator:e.deviceStateFinalResponseCreator},e.SET_COLOR_BLUEPRINT={actions:[new a.SendRelayRequestAction(e.createColorControlCommand),e.parseResponse,e.checkResponse],finalResponseCreator:e.deviceStateFinalResponseCreator},e.SET_COLOR_TEMPERATURE_BLUEPRINT={actions:[new a.SendRelayRequestAction(e.createColorTemperatureControlCommand),e.parseResponse,e.checkResponse],finalResponseCreator:e.deviceStateFinalResponseCreator},e.INCREASE_COLOR_TEMPERATURE_BLUEPRINT={actions:[e.sendStateQuery,e.parseResponse,e.checkResponse,new n.GetContextAction(e.increaseColorTemperature),new a.SendRelayRequestAction(e.createAdjustedColorTemperatureControlCommand),e.parseResponse,e.checkResponse],finalResponseCreator:e.deviceStateFinalResponseCreator},e.DECREASE_COLOR_TEMPERATURE_BLUEPRINT={actions:[e.sendStateQuery,e.parseResponse,e.checkResponse,new n.GetContextAction(e.decreaseColorTemperature),new a.SendRelayRequestAction(e.createAdjustedColorTemperatureControlCommand),e.parseResponse,e.checkResponse],finalResponseCreator:e.deviceStateFinalResponseCreator},e.DIRECTIVE_TO_BLUEPRINT_MAPPING={Alexa:{ReportState:e.REPORT_STATE_BLUEPRINT},"Alexa.BrightnessController":{AdjustBrightness:e.ADJUST_BRIGHTNESS_BLUEPRINT,SetBrightness:e.SET_BRIGHTNESS_BLUEPRINT},"Alexa.ColorController":{SetColor:e.SET_COLOR_BLUEPRINT},"Alexa.ColorTemperatureController":{SetColorTemperature:e.SET_COLOR_TEMPERATURE_BLUEPRINT,IncreaseColorTemperature:e.INCREASE_COLOR_TEMPERATURE_BLUEPRINT,DecreaseColorTemperature:e.DECREASE_COLOR_TEMPERATURE_BLUEPRINT},"Alexa.Discovery":{IdentifyEndpoints:e.IDENTIFY_ENDPOINTS_BLUEPRINT},"Alexa.PowerController":{TurnOff:e.TURN_OFF_BLUEPRINT,TurnOn:e.TURN_ON_BLUEPRINT}},e}();t.OrchestrationBlueprintStore=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.responseTemplateFunc=e}return e.prototype.createResponse=function(e,t,r){var o=this.responseTemplateFunc(e),n=o.event.header;return"Alexa"===n.namespace&&"ErrorResponse"===n.name?r(o):t(o)},e}();t.FinalResponseCreator=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.contextCallback=e}return e.prototype.perform=function(e,t,r){var o=!1;this.contextCallback(e,(function(e){o=!0,r(e)})),o||t()},e}();t.GetContextAction=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.perform=function(t,r,o){var n=t.payload.response.message,s=t.executionInfo.validateResponseModuleName,i=t.executionInfo.validateResponseMethodName;if(delete t.executionInfo.validateResponseModuleName,delete t.executionInfo.validateResponseMethodName,console.debug(e.className+":: Checking for errors in module: "+s+" method: "+i+" from the following response: "+JSON.stringify(n)),void 0===n[s]||null===n[s]||void 0===n[s][i]||null===n[s][i]||void 0===n[s][i].err_code||null===n[s][i].err_code)return console.error(e.className+":: Encountered unexpected response format: "+JSON.stringify(n)+" while looking for moduleName: "+s+" and methodName: "+i+"."),o({message:e.className+":: Encountered unexpected device response message format.",type:"INTERNAL_ERROR"});var a=n[s][i].err_code;return console.debug(e.className+":: Response error code: "+a+"."),0===a?r():o(-1===a||-2===a?{message:e.className+":: Encountered error code: "+a+". Action not supported by the device.",type:"INVALID_DIRECTIVE"}:{message:e.className+":: Encountered unknown device response error code: "+a+".",type:"INTERNAL_ERROR"})},e.className="ModuleErrorAction",e}();t.ModuleErrorAction=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(27),n=r(11),s=function(){function e(e){void 0===e&&(e=!0),this.stripHeader=e}return e.prototype.perform=function(t,r,s){void 0===t.payload.base64Response&&(console.debug(e.className+":: Getting base64Response from Identify Endpoints directive payload"),t.payload.base64Response=t.payload.initialDirectivePayload.base64Response);var i,a=n.Base64Util.dec(t.payload.base64Response);try{i=o.MessageWrapper.createFromEncryptedOctetStream("Response",a,this.stripHeader)}catch(t){var c=e.className+":: Unable to parse device response message";return console.error(c+", Message: "+a),s({message:c,type:"INTERNAL_ERROR"})}return t.payload.response=i,r()},e.className="ParseRelayResponseAction",e}();t.ParseRelayResponseAction=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),n=function(){function e(e,t){this.messageType=e,this.message=t}return e.createFromEncryptedOctetStream=function(t,r,n){void 0===n&&(n=!0),console.debug(e.className+":: receivedMessage --\x3e "+r);var s=r;n&&(s=o.TPLinkCrypto.stripHeader(r),console.debug(e.className+":: encryptedMessage --\x3e "+s));var i=o.TPLinkCrypto.decrypt(s);return console.debug(e.className+":: decryptedString --\x3e "+i),new e(t,JSON.parse(i))},e.prototype.toBinary=function(t){void 0===t&&(t=!0);var r=JSON.stringify(this.message);console.debug(e.className+":: messageString --\x3e "+r);var n=o.TPLinkCrypto.encrypt(r);console.debug(e.className+":: encryptedMessage --\x3e "+n);var s=n;return t&&(s=o.TPLinkCrypto.prependHeader(n)),console.debug(e.className+":: messageToSend --\x3e "+s),s},e.className="MessageWrapper",e}();t.MessageWrapper=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(29),n=r(2),s=r(10),i=r(11),a=function(){function e(e){this.payloadTemplateFunc=e}return e.prototype.perform=function(t,r,n){var a=this.payloadTemplateFunc(t);console.debug(e.className+":: unencrypted intermediate request payload: "+a);var c=s.TPLinkCrypto.encrypt(a),u=s.TPLinkCrypto.prependHeader(c),l=this.createRelayDirective(t.endpointId,{base64Request:i.Base64Util.enc(u),responseReadStrategy:{name:"ResponseByteSizeHeader",numBits:32,numOffsetBits:0}}),p=new o.RelayData.TCPRequestContext({directive:l},(function(o){return console.debug(e.className+":: Received relay response event: "+JSON.stringify(o)),t.payload.base64Response=o.event.payload.base64Response,r()}),(function(t){return console.error(e.className+":: Encountered TCP error response: "+JSON.stringify(t)),n({message:t.event.payload.message,type:t.event.payload.type})}));console.debug(e.className+":: Relaying intermediate request directive: "+JSON.stringify(l)),t.requestRelay.relay(p)},e.prototype.createRelayDirective=function(e,t){return{endpoint:{endpointId:e},header:{messageId:n.v4(),name:"SendRequest",namespace:"Alexa.TcpController",payloadVersion:"3"},payload:t}},e.className="SendRelayRequestAction",e}();t.SendRelayRequestAction=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(30);t.AlexaAPI=o;var n=r(4);t.RelayData=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(31);t.Capabilities=o;var n=r(32);t.Discovery=n;var s=r(33);t.LocalCapabilities=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}]);
